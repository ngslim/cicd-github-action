name: katalon-automate

on:
  workflow_run:
    workflows: ['heroku-deploy']
    types:
      - completed
jobs:
  katalon-automate:
    name: Katalon Automate
    runs-on: windows-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Run test suite
        uses: katalon-studio/katalon-studio-github-action@v3.0
        with:
          version: '7.5.5'
          projectPath: '${{ github.workspace }}'
          args: '-noSplash -retry=0 -browserType="Chrome" -testSuitePath="Test Suites/Basic Test Suite" -apiKey= ${{ secrets.API_KEY }} --config -webui.autoUpdateDrivers=true'
  send-mail:
    name: Send Mails
    runs-on: ubuntu-latest
    needs: [katalon-automate]
    if: ${{ always() && contains(needs.*.result, 'failure') }}
    steps:
      - name: Setup Python
        uses: actions/setup-python@v2
        with:
          python-version: 3.x
      - name: Send mail
        env:
          USER_EMAIL: ${{secrets.MAIL_USERNAME}}
          USER_PASSWORD: ${{secrets.MAIL_PASSWORD}}
        run: python .github/workflows/email_sending.py
